# 開発ガイドライン

## 新しいPythonファイルを追加する際のルール

### 1. 既存コードの確認

新しいPythonファイルを追加する前に、以下を確認してください：

- **`tools/`ディレクトリ**: 既存のツールに統合できる機能がないか
- **`main.py`**: コア機能として追加すべきか
- **`scripts_archive/`**: 過去に似た機能が実装されていないか

### 2. 統合の判断基準

以下の場合は既存ツールに統合してください：

- ✅ Markdownファイルの処理機能 → `tools/markdown_utils.py` または `tools/markdown_fixer.py`
- ✅ 会社情報の管理機能 → `tools/company_info_manager.py`
- ✅ コスト計算・概算機能 → `tools/cost_estimator.py`
- ✅ 一度限りの変換スクリプト → `tools/cli.py` にコマンドとして追加

### 3. 新しいツールの追加

既存ツールに統合できない場合は、以下を検討：

1. **`tools/`ディレクトリに新しいモジュールを作成**
   - 例: `tools/new_feature.py`
   - `tools/__init__.py`にエクスポートを追加
   - `tools/cli.py`にコマンドを追加（CLI経由で使用可能にする）

2. **再利用可能な関数として設計**
   - 単一責任の原則に従う
   - 他のモジュールからインポート可能にする
   - ドキュメント文字列を追加

3. **テスト可能な構造**
   - 関数は副作用を最小限に
   - 入力と出力が明確

### 4. 一度限りのスクリプト

以下の場合は`scripts_archive/`に配置：

- 一度だけ実行する変換スクリプト
- 実験的なコード
- 参考用のコード

ただし、実行後は`scripts_archive/`に移動することを推奨。

### 5. コア機能の追加

TaxoAdaptのコア機能として追加する場合：

- `main.py`、`taxonomy.py`、`expansion.py`などに追加
- 既存のアーキテクチャに従う
- 他のモジュールとの依存関係を考慮

## ツールの設計原則

### 再利用性

- **モジュール化**: 機能ごとに独立したモジュール
- **関数の独立性**: 他の関数から呼び出し可能
- **設定の外部化**: ハードコードを避け、設定ファイルや引数で制御

### 保守性

- **明確な命名**: 関数名、変数名が意図を明確に表現
- **ドキュメント**: docstringで機能を説明
- **型ヒント**: 可能な限り型ヒントを追加

### 拡張性

- **プラガブルな設計**: 新しい機能を追加しやすい構造
- **CLI統合**: `tools/cli.py`経由でアクセス可能にする
- **設定の柔軟性**: デフォルト値とカスタマイズ可能なオプション

## エコシステムの成長

### 段階的な機能追加

1. **プロトタイプ**: 一度限りのスクリプトとして実装
2. **検証**: 実際に使用して動作を確認
3. **統合**: 問題なければ`tools/`に統合
4. **ドキュメント化**: `tools/README.md`に追加

### コードレビューの観点

- 既存コードとの重複がないか
- 適切な場所に配置されているか
- 再利用可能な設計か
- ドキュメントが十分か

## 例: 新しいMarkdown処理機能を追加する場合

### ❌ 悪い例

```python
# fix_something.py (ルートに直接追加)
# 一度限りのスクリプトとして実装
```

### ✅ 良い例

```python
# tools/markdown_fixer.py に追加
def fix_something(file_path):
    """新しい修正機能"""
    # 実装
    pass

# tools/cli.py にコマンドを追加
parser_fix.add_argument('--something', action='store_true',
                       help='新しい修正機能を有効化')
```

## AI的アプローチについて

**結論: このアプローチは現代的で推奨される**

- ✅ **モジュール化**: 現代のソフトウェア開発のベストプラクティス
- ✅ **再利用性**: DRY原則（Don't Repeat Yourself）
- ✅ **保守性**: コードの整理と構造化
- ✅ **拡張性**: プラガブルな設計

AIが生成するコードも、このような構造化されたアプローチを推奨します。むしろ、一度限りのスクリプトを乱立させるよりも、このようなエコシステムとして育てる方が：

- 長期的な保守が容易
- チームでの共有が簡単
- 機能の再利用が可能
- テストが書きやすい

## チェックリスト

新しいPythonファイルを追加する前に：

- [ ] `tools/`ディレクトリに既存の機能がないか確認
- [ ] 既存ツールに統合できるか検討
- [ ] 再利用可能な設計になっているか
- [ ] `tools/cli.py`にコマンドを追加するか検討
- [ ] ドキュメントを追加
- [ ] 一度限りのスクリプトなら`scripts_archive/`に配置
